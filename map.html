<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Lviv Map – Houses</title>

    <link rel="stylesheet" href="leaflet/dist/leaflet.css" />
    <script src="leaflet/dist/leaflet.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<div id="map"></div>

<script>
    const map = L.map("map").setView([49.8419, 24.0315], 12);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
    }).addTo(map);

    let markers = [];

    async function loadAndPlot() {
        try {
            const res = await fetch(`./data/with_coords_temp.json?t=${Date.now()}`);
            const data = await res.json();

            // Видаляємо старі маркери
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            data.forEach(obj => {
                if (obj.lat == null || obj.lng == null) return;

                const marker = L.circleMarker([obj.lat, obj.lng], {
                    radius: 6,
                    fillColor: "red",
                    fillOpacity: 0.9,
                    color: "#000",
                    weight: 1
                }).addTo(map);

                marker.bindPopup(
                    `<b>${obj.street} ${obj.building}</b><br>Group: ${obj.group}`
                );

                markers.push(marker);
            });
        } catch (err) {
            console.error("Failed to load coordinates:", err);
        }
    }

    // Початкове завантаження
    loadAndPlot();

    // Періодичне оновлення кожні 15 секунд
    setInterval(loadAndPlot, 15000);
</script>
</body>
</html>
